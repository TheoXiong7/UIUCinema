{% extends "base.html" %}

{% block title %}Search Results{% endblock %}

{% block content %}
<main class="max-w-7xl mx-auto px-4 py-8">
    <!-- Search Bar -->
    <div class="mb-8">
        <form action="/search" method="GET">
            <div class="flex flex-col sm:flex-row gap-3">
                <input
                    type="text"
                    name="q"
                    value="{{ query }}"
                    placeholder="Search for movies..."
                    class="flex-1 px-6 py-4 text-lg border-2 border-black focus:outline-none focus:ring-4 focus:ring-purple-200 font-medium"
                    required
                >
                <button
                    type="submit"
                    class="px-8 py-4 bg-black text-white font-bold text-lg border-2 border-black hover:bg-gray-800 transition-all duration-200 uppercase tracking-wide"
                >
                    Search
                </button>
            </div>
        </form>
    </div>

    <!-- Results Header -->
    <div class="mb-6">
        <h1 class="text-2xl md:text-3xl font-bold text-black mb-2">
            {% if results %}
                Found {{ results|length }} results for "{{ query }}"
            {% elif message %}
                {{ message }}
            {% else %}
                No results found for "{{ query }}"
            {% endif %}
        </h1>
        {% if results %}
        <p class="text-gray-600 text-sm">
            Ranked by hybrid score (BM25 + Semantic Similarity)
        </p>
        {% endif %}
    </div>

    <!-- Results List -->
    {% if results %}
    <div class="space-y-3">
        {% for movie in results %}
        <div class="border-2 border-gray-300 bg-white hover:border-black transition-colors group">
            <div class="p-4 relative">
                <div class="float-right ml-4 mb-2">
                    <div class="relative w-16">
                        <div class="border-2 border-black bg-white relative h-20">
                            <!-- gradient fill -->
                            {% set score_pct = (movie.score * 100) | round(0) | int %}
                            {% if score_pct >= 80 %}
                                {% set battery_color = 'bg-green-500' %}
                            {% elif score_pct >= 60 %}
                                {% set battery_color = 'bg-yellow-500' %}
                            {% elif score_pct >= 40 %}
                                {% set battery_color = 'bg-orange-500' %}
                            {% else %}
                                {% set battery_color = 'bg-red-500' %}
                            {% endif %}

                            <div class="absolute bottom-0 left-0 right-0 {{ battery_color }} transition-all duration-300"
                                 style="height: {{ movie.score * 100 }}%;">
                            </div>

                            <!-- Percentage text overlay -->
                            <div class="absolute inset-0 flex flex-col items-center justify-center z-10">
                                <div class="text-lg font-bold text-black">
                                    {{ score_pct }}%
                                </div>
                            </div>
                        </div>
                        <div class="text-[9px] uppercase tracking-wider font-bold text-center text-gray-600 mt-1">
                            Match
                        </div>
                    </div>
                </div>

                <!-- Title and metadata -->
                <h2 class="text-lg md:text-xl font-bold text-black mb-1 group-hover:underline">
                    {{ movie.title }}
                </h2>
                <div class="flex flex-wrap items-center gap-2 text-xs text-gray-600 mb-2">
                    <span class="font-medium">{{ movie.year }}</span>
                    <span class="px-2 py-0.5 bg-gray-100 border border-gray-300 text-gray-700 uppercase tracking-wide text-[10px] font-bold">
                        {{ movie.genre }}
                    </span>
                </div>

                <!-- Synopsis -->
                <div class="mt-1">
                    <p class="text-sm text-gray-700 leading-relaxed">
                        {{ movie.synopsis }}
                    </p>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <!-- No Results State -->
    <div class="border-2 border-dashed border-gray-300 rounded-lg p-12 text-center">
        <div class="text-6xl mb-4">üé¨</div>
        <h3 class="text-xl font-bold text-gray-700 mb-2">No movies found</h3>
        <p class="text-gray-600 mb-6">
            Try adjusting your search query or browse our example queries
        </p>
        <a href="/" class="inline-block px-6 py-3 bg-black text-white font-bold border-2 border-black hover:bg-gray-800 uppercase tracking-wide">
            Back to Search
        </a>
    </div>
    {% endif %}

    <!-- Back to Search -->
    {% if results %}
    <div class="mt-8 text-center">
        <a href="/" class="inline-block px-6 py-3 border-2 border-black text-black font-bold hover:bg-black hover:text-white transition-colors uppercase tracking-wide">
            ‚Üê New Search
        </a>
    </div>
    {% endif %}
</main>
{% endblock %}
